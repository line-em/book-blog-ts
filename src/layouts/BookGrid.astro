---
import Layout from "../layouts/Layout.astro";
import { getAverageStars } from "../utils/rating";
import { getMostReadGenres } from "../utils/genres";
import "../styles/year.styles.css";
import { getBooks } from "../utils/getBooks";
import { yearList } from "../content/yearList";

export interface Props {
	year?: number;
}

const { year } = Astro.props;

let books;

if (year) {
	books = await getBooks(year);
} else {
	books = await getBooks();
}

const averageStars = getAverageStars(books.map((book) => book.data.score));
const mostReadGenres = getMostReadGenres(books);
---

<Layout title="Book List">
	<main class="instructions">
		<nav>
			<h1><span class="text-gradient">Book</span>{" "}List</h1>
			<section class="nav-buttons">
				{
					yearList.map((year) => (
						<a href={`/${Number(year)}`} class="button-style">
							{year}
						</a>
					))
				}
			</section>
		</nav>

		<h4>
			Books read:
			<span class="text-gradient">{books.length}</span> / Most read {
				mostReadGenres.length > 1 ? "genres:" : "genre:"
			}
			<span class="text-gradient">{mostReadGenres.join(", ")}</span> / Average rating:
			<span class="text-gradient">{averageStars}</span>
		</h4>
		<slot />
	</main>
</Layout>
