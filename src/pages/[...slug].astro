---
import { getCollection } from "astro:content";
import { getStars } from "../utils/rating";
import { getImagePath, removeYearFromPath } from "../utils/digits";

import "../styles/bookpage.styles.css";
import Layout from "../layouts/Layout.astro";
import BookGrid from "../layouts/BookGrid.astro";
import BookReview from "../layouts/BookReview.astro";

export async function getStaticPaths() {
	const bookEntries = await getCollection("books");
	return bookEntries.map((entry: { slug: string }) => ({
		params: { slug: entry.slug },
		props: { entry }
	}));
}

const { entry } = Astro.props;
const { Content } = await entry.render();

let { title, author, month, score, image, year, genre } = entry.data;
image = "../../" + getImagePath(image, year);

const heroImage = entry.data.heroimage
	? `../../${getImagePath(entry.data.heroimage[0], year)}`
	: null;
const extraImage = entry.data.extraimage
	? `../../${getImagePath(entry.data.extraimage, year)}`
	: null;
const extraImages = entry.data.extraimages
	? entry.data.extraimages.map((image: string) => `../../${getImagePath(image, year)}`)
	: null;
---

<BookReview
	score={score}
	year={year}
	month={month}
	genres={genre}
	cover={image}
	title={title}
>
	<!-- <Layout title={title}> -->
	<main class="instructions center p-top-base">
		<h1>
			<span class="text-gradient">{title}</span>
		</h1>
		<h3>by {author}</h3>
		<div class="wrapper">
			<section class="book-review">
				<article class="book-content">
					{
						heroImage && (
							<img
								src={heroImage}
								alt={title}
								class={
									entry.data.heroimage[1] === "full"
										? "image"
										: "image right"
								}
							/>
						)
					}
					<Content />
					{
						extraImage && (
							<img src={extraImage} alt={title} class="image m-top" />
						)
					}
					{
						extraImages && (
							<div class="extra-images">
								<img src={extraImages[0]} alt={title} class="image" />
								<img src={extraImages[1]} alt={title} class="image" />
							</div>
						)
					}
				</article>
			</section>
		</div>
	</main>
</BookReview>
