---
import { getCollection } from "astro:content";
import { getStars } from "../utils/rating";

import "../styles/bookpage.styles.css";
import { getImagePath } from "../utils/digits";
import Layout from "../layouts/Layout.astro";

export async function getStaticPaths() {
	const bookEntries = await getCollection("books");
	return bookEntries.map((entry: { slug: string }) => ({
		params: { slug: entry.slug },
		props: { entry }
	}));
}

const { entry } = Astro.props;
const { Content } = await entry.render();

let { title, author, month, score, image, year, genre } = entry.data;
image = `.${getImagePath(image, year)}`;

const heroImage = entry.data.heroimage
	? `.${getImagePath(entry.data.heroimage[0], year)}`
	: null;
const extraImage = entry.data.extraimage
	? `.${getImagePath(entry.data.extraimage, year)}`
	: null;
const extraImages = entry.data.extraimages
	? entry.data.extraimages.map((image: string) => `.${getImagePath(image, year)}`)
	: null;
---

<Layout title={title}>
	<main class="instructions m-top">
		<a href={`../../`} rel="noopener noreferrer" class="center">Go Back</a>
		<h1>
			<span class="text-gradient">{title}</span>
		</h1>
		<h3>by {author}</h3>
		<section class="book-review">
			<article class="instructions">
				<img src={image} alt={title} class="book-cover-big" />
				<aside>
					<span set:html={getStars(score)} />
					<h3>Read on</h3>
					<p>
						{month}, {year}
					</p>
					<hr />
					<h3>Tags</h3>
					<p class="pill-flex">
						{
							genre.map((genre: [string]) => (
								<span class="pill">{genre}</span>
							))
						}
					</p>
					<hr />
				</aside>
			</article>
			<article class="instructions" style="flex-basis: 600px">
				{
					heroImage && (
						<img
							src={heroImage}
							alt={title}
							class={
								entry.data.heroimage[1] === "full"
									? "image"
									: "image right"
							}
						/>
					)
				}
				<Content />
				{extraImage && <img src={extraImage} alt={title} class="image m-top" />}
				{
					extraImages && (
						<div class="extra-images">
							<img src={extraImages[0]} alt={title} class="image" />
							<img src={extraImages[1]} alt={title} class="image" />
						</div>
					)
				}
			</article>
		</section>
	</main>
</Layout>
