---
import Layout from "../layouts/Layout.astro";
import { getAverageStars } from "../utils/rating";
import { getMostReadGenres } from "../utils/genres";
import "../styles/year.styles.css";
import GridImage from "../components/GridImage.astro";
import { getBooks } from "../utils/getBooks";

let books = await getBooks();

const averageStars = getAverageStars(books.map((book) => book.data.score));
const mostReadGenres = getMostReadGenres(books);

const params = [...new Set(books.map((book) => book.data.year))];
---

<Layout title="Read Books">
	<main class="instructions">
		<nav>
			<h1><span class="text-gradient">Book</span>{" "}List</h1>
			<section class="nav-buttons">
				{
					params.map((year) => (
						<a href={`/${year}`} class="button-style">
							{year}
						</a>
					))
				}
			</section>
		</nav>

		<h4>
			Books read:
			<span class="text-gradient">{books.length}</span> / Most read {
				mostReadGenres.length > 1 ? "genres:" : "genre:"
			}
			<span class="text-gradient">{mostReadGenres.join(", ")}</span> / Average rating:
			<span class="text-gradient">{averageStars}</span>
		</h4>

		<GridImage books={books} />
	</main>
</Layout>
