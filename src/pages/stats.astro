---
import { CollectionEntry, getCollection } from 'astro:content'
import Layout from '../layouts/Layout.astro'
import '../styles/global.css'
import { validYears } from '../content/config'
import {
	getMostReadGenresByYear,
	getTop5MostReadGenres,
	getBooksByGenre,
	getBooksByGenreAndYear
} from '../utils/genres'
import BookGrid from '../layouts/BookGrid.astro'
import DonutChart from '../components/DonutChart'
import ReadingStats from "../layouts/ReadingStats.astro";

const allBooks: CollectionEntry<'books'>[] = await getCollection('books')
const genresByYear = getMostReadGenresByYear(allBooks, validYears)
---

<Layout title="All Books" transition:name={`books`}>
	<BookGrid>
		<section class="wrapper p-6 md:p-8 bg-gray-50 rounded-lg shadow-lg">
			<h2 class="text-3xl text-gradient font-bold">
				Top 5 Genres by Year with Book Titles
			</h2>
			<!--<DonutChart data={genresByYear['2021']} year={2021} client:only="react" />-->
			<!--<DonutChart data={genresByYear['2022']} year={2022} client:only="react" />-->
			<!--<DonutChart data={genresByYear['2023']} year={2023} client:only="react" />-->
			<!--<DonutChart data={genresByYear['2024']} year={2024} client:only="react" />-->
			<ReadingStats books={allBooks} />
			<section class="flex flex-col gap-8 mx-auto">
				{validYears.map((year) => (
					<div class="flex flex-col lg:flex-row border-b border-slate-200 pb-8 gap-4 justify-between">
						<DonutChart data={genresByYear[year]} year={year} client:only="react" />
						<!--<h3 class="text-4xl font-semibold text-gray-700 dark:text-gray-300 mb-2">{year}</h3>-->
						<ul class="gap-4 pt-8 grid grid-cols-2 xl:grid-cols-3 grid-flow-dense flex-1">
							{Object.entries(genresByYear[year] || {}).map(([genre, count]) => (
								<li
									class="py-2 flex flex-col text-left items-start"
								>
									<strong>{genre}</strong>
									{getBooksByGenreAndYear(allBooks, genre, year).map((book) => (
										<a class="pl-4 text-sm border-l border-l-violet-500" href={book.slug}>
										{book.title}
									</a>
									))}
								</li>
							))}
						</ul>
					</div>
				))}
			</section>
		</section>
	</BookGrid>
</Layout>
<!--<div class="flex flex-col items-center gap-2 text-lg font-medium text-gray-700 dark:text-gray-300">-->
<!--	<strong class="text-violet-600 dark:text-violet-400">{genre}</strong>-->
<!--	<span class="text-sm text-gray-500 dark:text-gray-400">({count} reads)</span>-->
<!--</div>-->
<!--<ul class="mt-2 space-y-1 ml-4 text-gray-600 dark:text-gray-400">-->